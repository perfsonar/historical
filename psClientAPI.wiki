#summary perfSONAR client API

= Introduction =

A standard, straightforward client API specification would be useful to users of perfSONAR. It could be implemented in a variety of languages.

= Preliminaries =

== Language mapping ==

It is assumed that the language in question has a standard way of representing, and iterating over, lists of items. 

== Formats ==

  * Input parameters use this format: (`Type`) _param-name_ {default-value}: Description.
  * Attributes drop the default value: (`Type`) _attribute-name_: Description

= Specification = 

== Operations ==

create_client
  * Description: Construct and initialize a new client.
  * In:
    * (string) gls_hints_file {""}: Use gLS root hints file, if given; default is 'http://www.perfsonar.net/gls.root.hints'
    * (list of URL) gls_urls {empty list}:  list of gLS servers 
    * (list of URL) hls_urls {empty list}: list of hLS servers
    * (list of URL) service_urls {empty list}: list of services to query without consulting LS infrastructure
  * Out: 
    * `Client`

get_data
  * Description: Specify data to be fetched
  * In: 
    * (`Client`) client {required}: Client instance from create_client()
    * (URL) datatype {required}: Name of characteristic or tool. The API should enumerate some commonly used types.
    * (`Subject`) subject {required}:  Subject, in the perfsonar sense, of the data
    * (`Parameters`) parameters {null}: Additional metadata parameters
    * (`TimeRange`) timerange {null}: If non-empty, a time range filter
  * Out: 
    * list of `DataSet` 

== Data types ==

The data types are listed alphabetically.

Client
  * Description: Opaque handle for client operations
  * Attributes: None

!DataSet
  * Description: Data and associated metadata
  * Attributes:
    * (URL) service_url: The URL from which the measurements are being retrieved
    * (list of `MeasurementSet`): Sets of Measurements associated with this data set
 
!EndpointPair
  * Description: subclass of !NetworkElements for 2 endpoint pairs
  * Attributes:
    * (string) source
    * (string) destination

Interface
  * Description: subclass of !NetworkElements for host interfaces
  * Attributes:
    * (string) host
    * (string) host_address
    * (string) interface_name
    * (string) interface_address

Measurement
  * Description: Summarized or "raw" measurement result.
  * Attributes:
    * (`TimeRange`) time_range:  Time range of the data. 
    * (URL) summtype: If non-empty, the type of summarization as a URL in a namespace. The API should define an enumeration of common types.
    * (list of string) header: If non-empty, the name associated with each value in the tuples of `values`. If empty, each tuple in values should be of length one (1).
    * (list of tuples) values: One or more tuples, each the same length as the `header`, containing associated data values.
    * (`Parameters`) parameters: parameters such as units, bucket_width, or sampling_frequency, that apply to the measurements

!MeasurementSet
  * Description: One or more Measurement items, and associated metadata (subject and parameters), if different from the containing `DataSet` metadata.
  * Attributes:
    * (URL) datatype: Name of characteristic or tool assoc. with measurements
    * (`Subject`) subject: Subject for this set of measurements.
    * (`Parameters`) parameters: Parameters that apply to all measurements in this set.
    * (list of `Measurement`) measurements: Measurements for this set

!NetworkElements
  * Description: Abstract Topology schema element.
  * Subclasses: !EndpointPair, Interface

Parameters
  * Description: Generic name=value hash or array

Subject
  * Description: Abstract perfSONAR Subject
  * Subclasses: !NetworkElements

!TimeRange
  * Description: Start and/or end time
  * Attributes:
    * (time) start_time: Time value, if empty then "beginning of time"
    * (time) end_time: Time value, if empty then "end of time"

= Examples =

== Fetch one throughput measurement between hostA and hostB ==

*Python*-ish example
{{{
import psapi

# connect
client = psapi.create_client() # use default roots

# create endpoint obj.
endpoints = psapi.EndpointPair(source='hostA', dest='hostB')

# get data for endpoints
result = client.get_data(subject=endpoints, datatype=psapi.THROUGHPUT)

# print the data values from each measurement set as
# comma-separated values, without further interpretation
for data_set in result:
  print("Service: " + data_set.service_url)
  for meas_set in data_set:
    print("Subject: " + meas_set.subject)
    print("Params : " + meas_set.parameters)
    for meas in meas_set.measurements:
       print(','.join(meas.header)) # print header items separated by a comma
       for value in meas.values:
           print(','.join(value)) # print value tuple items sep. by a comma
}}} 