= Service Registration = 

A proposal for what the _*service*_ element that gets registered in the *hLS*
might look like for various service cases.

= Use Cases =

  * A service speaks two versions of a protocol for the same function
  * A service speaks two distinct protocols for distinct functions
  * An service wants to register some of its settings (either per protocol, or service wide) 

= Examples =

== The Node ==

The node istself needs to be registered by _someone_.  Each service should have the logic to:

 # Determine with the *gLS* or *hLS* if the node has been registered already.  
 ## If it cannot be _reasonably_ determined, make/register a new node definition
 ### Reasonable can mean if no results come back for search criteria.
 ### Reasonable can also mean if *too many* results come back to determine if any are correct.
 ## Use one of the returned results, specifically the URI, in your service registration as the node you are on.
 # Potentially determine if an existing registration exists that matches (if the serivice were rebooted after a configuration change, it should re-register the new info)

Note that this example is taking into consideration the use of the *gLS* as the registration/lookup medium instead of some other form of local resolution (e.g. services trying to determine what other services are on the same machine and coordinating with them).  

The following is a simple node example:

{{{
<nmtb:node id="vogf:network:domain=internet2.edu:node=lab244"
           xmlns:nmtb="http://ogf.org/schema/network/topology/base/20070828/" 
           xmlns:nmtl3="http://ogf.org/schema/network/topology/l3/20070828/">
  <nmtb:name type="dns">lab244.internet2.edu</nmtb:name>
  <nmtl3:port>
    <nmtl3:address type="ipv4">207.75.164.244</nmtl3:address>
  </nmtl3:port>
  <nmtl3:port>
    <nmtl3:address type="ipv6">2001:468:1420:3:214:22ff:fe72:8ae6</nmtl3:address>
  </nmtl3:port>
</nmtb:node>
}}}

Another example with more information:

{{{
<nmtb:node id="vogf:network:domain=internet2.edu:node=lab244"
           xmlns:nmtb="http://ogf.org/schema/network/topology/base/20070828/" 
           xmlns:nmtl3="http://ogf.org/schema/network/topology/l3/20070828/">
  <nmtb:name type="dns">lab244.internet2.edu</nmtb:name>
  <nmtl3:port>
    <nmtl3:address type="ipv4">207.75.164.244</nmtl3:address>
  </nmtl3:port>
  <nmtl3:port>
    <nmtl3:address type="ipv6">2001:468:1420:3:214:22ff:fe72:8ae6</nmtl3:address>
  </nmtl3:port>
</nmtb:node>
}}}

== NDT ==

First a simple example:

{{{
<nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/" 
              id="urn:ogf:network:domain=internet2.edu:node=ndt:service=NDT">
    
        <!-- basic stuff, same as before -->      
    <nmtb:name>Internet2 NDT Server</nmtb:name>
    <nmtb:description>NDT Server at Internet2 in Ann Arbor, MI USA</nmtb:description>

        <!-- 'structured' type (should maintain a list somwhere), there could be
              many of these (if they are equal or close to being equal) -->
    <nmtb:type>http://e2epi.internet2.edu/tools/ndt</nmtb:type>

        <!-- This is how we map to a node, this node should exist in the topo/LS either
             before we start, or we register it -->
    <nmtb:relation type="runsOn">
        <nmtb:idRef type="node">urn:ogf:network:domain=internet2.edu:node=ndt</nmtb:idRef>
    </nmtb:relation>

        <!-- Think of this as an 'application layer' port, not necessarily the
             same as a L4/L3 port -->
    <nmtb:port>

        <!-- For our purposes we usually need an address (contact point) as well
             as the protocol supported -->
        <nmtb:address type="uri">tcp://207.75.164.244:3000</nmtb:address>
        <nmtb:address type="uri">tcp://[2001:468:1420:3:214:22ff:fe72:8ae6]:3000</nmtb:address>

        <nmtb:protocol type="http://e2epi.internet2.edu/ndt/nonhttp/3.1" />
    </nmtb:port>

     <nmtb:port>
        <nmtb:address type="url">http://207.75.164.244:7123</nmtb:address>
        <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:7123</nmtb:address>
        
        <nmtb:protocol type="http://e2epi.internet2.edu/ndt/http/3.1" />
    </nmtb:port>

</nmtb:service>
}}}

The next example fills in some gaps and takes the idea of the port one step further (*NB:* this will not be a common case, but is placed here for example).

{{{
<nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/" 
              id="urn:ogf:network:domain=internet2.edu:node=ndt:service=NDT">
      
    <nmtb:name>Internet2 NDT Server</nmtb:name>
    <nmtb:description>NDT Server at Internet2 in Ann Arbor, MI USA</nmtb:description>
    <nmtb:type>http://e2epi.internet2.edu/tools/ndt</nmtb:type>

    <nmtb:relation type="runsOn">
        <nmtb:idRef type="node">urn:ogf:network:domain=internet2.edu:node=ndt</nmtb:idRef>
    </nmtb:relation>

        <!-- this is a little more exact, we are defining an actual port here (many things may run on this) -->
    <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=ndt:port=tcp_7123">
        <nmtb:address type="uri">tcp://207.75.164.244:7123</nmtb:address>
        <nmtb:address type="uri">tcp://[2001:468:1420:3:214:22ff:fe72:8ae6]:7123</nmtb:address>

            <!-- Does this need to be there? Can we standardize this?  Would folks bother searching 
                 for it? -->
        <nmtb:protocol type="http://protocols/tcp/1.0" />
    </nmtb:port>

    <nmtb:port>
        <nmtb:address type="url">http://207.75.164.244:7123</nmtb:address>
        <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:7123</nmtb:address>
        
            <!-- we wold reference it here, it could also be a topo lookup if it existed already -->
        <nmtb:relation name="runsOn">
            <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=ndt:port=tcp_7123</nmtb:idRef>
        </nmtb:relation>

            <!-- the protocol can be full of stuff, like parameters (optional)-->
        <nmtb:protocol type="http://e2epi.internet2.edu/ndt/http/3.1">
            <nmtb:parameters>
                <nmtb:parameter name="some_protocol_parameter"/>its_value<nmtb:parameter>
            </nmtb:parameters>
        </nmtb:protocol>

            <!-- There could be parameters for the endpoint itself (optional) -->
        <nmtb:parameters>
            <nmtb:parameter name="some_end_point_parameter"/>its_value<nmtb:parameter>
        </nmtb:parameters>
    </nmtb:port>

        <!-- There could be parameters for the service too (optional) -->
    <nmtb:parameters>
        <nmtb:parameter name="some_service_parameter"/>its_value<nmtb:parameter>
    </nmtb:parameters>
    
</nmtb:service>
}}}

== BWCTL ==

BWCTL will work in the same manner.  This particular example does feature the extended port idea.

{{{
<!-- BWCTL Service. Speaks version 1.3 of the protocol -->
<nmtb:service id="urn:ogf:network:domain=internet2.edu:node=lab244:service=BWCTL">
    <nmtb:name>Internet2 BWCTL Server</nmtb:name>
    <nmtb:description>BWCTL Server at Internet2 in Ann Arbor, MI USA</nmtb:description>
    <nmtb:type>http://e2epi.internet2.edu/tools/bwctl</nmtb:type>

    <nmtb:relation type="runsOn">
        <nmtb:idRef type="node">ogf:network:domain=internet2.edu:node=lab244</nmtb:urn>
    </nmtb:relation>

    <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_4823">
        <nmtb:address type="uri">tcp://64.57.17.34:4823</nmtb:address>

        <!-- NB: I left out the TCP designation here, i think it works fine without it -->
    </nmtb:port>

    <nmtb:port> 
        <nmtb:address type="uri">tcp://64.57.17.34:4823</nmtb:address>
        
            <!-- we wold reference it here, it could also be a topo lookup if it existed already -->
        <nmtb:relation name="runsOn">
            <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_4823</nmtb:idRef>
        </nmtb:relation>

            <!-- speaks version 1.3 of the protocol, more of these may be possible in this block if they are compat -->
        <nmtb:protocol type="http://e2epi.internet2.edu/bwctl/1.3">
            <nmtb:parameters>
                <nmtb:parameter name="tool">http://dast.nlanr.net/Projects/Iperf/2.0.2</nmtb:parameter>
                <nmtb:parameter name="tool">http://www.lcp.nrl.navy.mil/nuttcp/5.5.5</nmtb:parameter>
                <nmtb:parameter name="tool">http://e2epi.internet2.edu/thrulay/0.9</nmtb:parameter>
            </nmtb:parameters>
        </nmtb:protocol>
    </nmtb:port>
    
    <nmtb:port>
        <nmtb:address type="uri">tcp://64.57.17.34:4823</nmtb:address>

            <!-- we wold reference it here, it could also be a topo lookup if it existed already -->
        <nmtb:relation name="runsOn">
            <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_4823</nmtb:idRef>
        </nmtb:relation>
        
            <!-- speaks version 1.2 of the protocol, which may not be the same -->
        <nmtb:protocol type="http://e2epi.internet2.edu/bwctl/1.2" />
    </nmtb:port>

</nmtb:service>
}}}

== OWAMP ==

The OWAMP example as a couple of protocol options.  

{{{
<nmtb:service id="urn:ogf:network:domain=net.internet2.edu:node=bwctl.chic:service=OWAMP">

    <nmtb:name>Internet2 OWAMP Server</nmtb:name>
    <nmtb:description>OWAMP Server at Internet2 in Chicago IL, USA</nmtb:description>
    <nmtb:type>http://e2epi.internet2.edu/tools/owamp</nmtb:type>

    <nmtb:relation type="runsOn">
        <nmtb:idRef type="node">urn:ogf:network:domain=net.internet2.edu:node=bwctl.chict</nmtb:urn>
    </nmtb:relation>

        <!-- Here we break the protocol type into elements since there are many of them, 
             should they always be elements? -->
    <nmtb:port>
        <nmtb:address type="uri">tcp://207.75.164.244:861</nmtb:address>
        <nmtb:address type="uri">tcp://[2001:468:1420:3:214:22ff:fe72:8ae6]:861</nmtb:address>
        
        <nmtb:protocol>
            <nmtb:type>http://e2epi.internet2.edu/owamp/3.1</nmtb:type>
            <nmtb:type>http://e2epi.internet2.edu/owamp/3.0</nmtb:type>
        
            <nmtb:parameters>
                <nmtb:parameter name="serviceMode">open</nmtb:parameter>
                <nmtb:parameter name="serviceMode">authenticated</nmtb:parameter>
                <nmtb:parameter name="serviceMode">encrypted</nmtb:parameter>
            </nmtb:parameters>
        </nmtb:protocol>
    </nmtb:port>
    
</nmtb:service>
}}}

== PingER ==

PingER is the first perfSONAR service, but note we are using the _generic_ service element here too.  I the future all services (regardless of affiliation) should be made in this manner.

{{{
<nmtb:service id="urn:ogf:network:domain=internet2.edu:node=lab244:service=PingER_MA">

    <nmtb:name>Internet2 PingER MA</nmtb:name>
    <nmtb:description>PingER MA at Internet2 in Ann Arbor, MI USA</nmtb:description>

        <!-- we need a better designation here... -->
    <nmtb:type>MA</nmtb:type>

    <nmtb:relation type="runsOn">
        <nmtb:idRef type="node">urn:ogf:network:domain=internet2.edu:node=lab244</nmtb:urn>
    </nmtb:relation>

    <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_8075">
        <nmtb:address type="uri">tcp://207.75.164.244:8075</nmtb:address>

        <!-- NB: I left out the TCP designation here, i think it works fine without it -->
    </nmtb:port>

    <nmtb:port>
        <nmtb:address type="url">http://lab244.internet2.edu:8075/perfSONAR_PS/services/pinger/ma</nmtb:address>
 
        <nmtb:relation name="runsOn">
            <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_8075</nmtb:idRef>
        </nmtb:relation>
        
        <nmtb:protocol>
            <nmtb:type>http://perfsonar.net/ma/1.0</nmtb:type>
            <nmtb:type>http://perfsonar.net/ma/pinger/1.0/</nmtb:type>

            <nmtb:parameters>
                <nmtb:parameter name="supportedMessage">SetupDataRequest</nmtb:parameter>
                <nmtb:parameter name="supportedMessage">MetadataKeyRequest</nmtb:parameter>
            </nmtb:parameters>
        </nmtb:protocol>
    </nmtb:port>
    
    <nmtb:port>
        <nmtb:address type="url">http://lab244.internet2.edu:8075/perfSONAR_PS/services/pinger/ma</nmtb:address>

        <nmtb:protocol type="">
            <nmtb:type>http://perfsonar.net/ma/1.1</nmtb:type>
            <nmtb:type>http://perfsonar.net/ma/pinger/1.1/</nmtb:type>
            <nmtb:type>http://perfsonar.net/ma/pinger/1.2/</nmtb:type>
                        
            <nmtb:parameters>
                <nmtb:parameter name="supportedMessage">SetupDataRequest</nmtb:parameter>
                <nmtb:parameter name="supportedMessage">MetadataKeyRequest</nmtb:parameter>
                <nmtb:parameter name="supportedMessage">MetadataQueryRequest</nmtb:parameter>
                <nmtb:parameter name="supportedMessage">MetadataUpdateRequest</nmtb:parameter>
                <nmtb:parameter name="supportedMessage">MetadataDeleteRequest</nmtb:parameter>
            </nmtb:parameters>
        </nmtb:protocol>
    </nmtb:port>    

</nmtb:service>



<nmtb:service id="urn:ogf:network:domain=internet2.edu:node=lab244:service=PingER_MP">

    <nmtb:name>Internet2 PingER MP</nmtb:name>
    <nmtb:description>PingER MP at Internet2 in Ann Arbor, MI USA</nmtb:description>

        <!-- we need a better designation here... -->
    <nmtb:type>MP</nmtb:type>

    <nmtb:relation type="runsOn">
        <nmtb:idRef type="node">urn:ogf:network:domain=internet2.edu:node=lab244</nmtb:urn>
    </nmtb:relation>

    <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_8075">
        <nmtb:address type="uri">tcp://207.75.164.244:8075</nmtb:address>

        <!-- NB: I left out the TCP designation here, i think it works fine without it -->
    </nmtb:port>

    <nmtb:port>
        <nmtb:address type="url">http://lab244.internet2.edu:8075/perfSONAR_PS/services/pinger/mp</nmtb:address>
 
        <nmtb:relation name="runsOn">
            <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=lab244:port=tcp_8075</nmtb:idRef>
        </nmtb:relation>
        
        <nmtb:protocol>
            <nmtb:type>http://perfsonar.net/mp/1.0</nmtb:type>
            <nmtb:type>http://perfsonar.net/mp/pinger/1.0/</nmtb:type>

            <!-- what sort of parameters? -->
        </nmtb:protocol>
    </nmtb:port>
      
</nmtb:service>
}}}

== DCN ==

There are three examples for the DCN world:
  
 # [ServiceRegistration#Example_1 IDC & NB as one service]
 # [ServiceRegistration#Example_2 IDC & NB as seperate services, seperate machines (or same machine)]

===  Example 1  ===

In thise example the IDC has its own notification broker, so it will advertise as such.

{{{
<nmwg:metadata xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"
               id="meta1">

    <dcn:subject xmlns:dcn="http://ggf.org/ns/nmwg/tools/org/dcn/1.0/">

        <nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/"
                      id="ogf:network:domain=internet2.edu:node=test-idc:service=OSCARS_IDC">
                    
            <nmtb:name>OSCARS IDC</nmtb:name>
            <nmtb:description>OSCARS IDC, Ann Arbor, MI USA</nmtb:description>
        
                <!-- need something better here... -->
            <nmtb:type>IDC</nmtb:type>

                <!-- IDC needs to advertise domains it controls -->
            <nmtb:relation name="controls">
                <nmtb:idRef type="domain">urn:ogf:network:domain=dcn.internet2.edu</nmtb:idRef>
            </nmtb:relation>

                <!-- The IDC can subscribe to the notifications of other IDCs/NBs (look for the 'notify' message below) -->
            <nmtb:relation type="subscriber">
                <!-- this seems more natural
                
                <nmtb:idRef type="service">ogf:network:domain=es.net:node=test-idc:service=OSCARS_IDC</nmtb:idRef>

                -->
            
                <!-- this works just as well, i guess (can just do a lookup on the above) -->
                <nmtb:address type="uri">https://test-idc.es.net:7564/axis2/services/OSCARS</nmtb:address>
            </nmtb:relation>

                <!-- First indicate that we are running on the TCP Port -->
            <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_8443">
                <nmtb:address type="uri">tcp://207.75.164.204:8443</nmtb:address>
            </nmtb:port>

                 <!-- Even though we are using the same endpoint, we want to advertise
                      the port two times (hacky...) -->

            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:8443/axis2/services/OSCARS</nmtb:address>

                <nmtb:relation name="runsOn">
                    <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_8443</nmtb:idRef>
                </nmtb:relation>

                <nmtb:protocol>
                        <!-- TBD pending DICE meeting ... 
                    
                        http://dice.controlplane.net/idc ?
                    
                        -->
                    <nmtb:type>http://oscars.es.net/OSCARS</nmtb:type>

                    <nmtb:parameters>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#createReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#modifyReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#cancelReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#createPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#refreshPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#teardownPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#queryReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#listReservations</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#getNetworkTopology</nmtb:parameter>
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>

                <!-- note I am the same endpoint -->
            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:8443/axis2/services/OSCARS</nmtb:address>

                <nmtb:relation name="runsOn">
                    <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_8443</nmtb:idRef>
                </nmtb:relation>
    
                <nmtb:protocol>
                        <!-- TBD pending DICE meeting ... 
                    
                        http://dice.controlplane.net/nb ?
                    
                        -->
                    <nmtb:type>http://docs.oasis-open.org/wsn/b-2</nmtb:type>

                    <nmtb:parameters>
                            <!-- It accepts Notify messages from other services to 
                                 which it's subscribed, note look for the 'subscriber' above to see if we need this... -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Notify</nmwg:parameter>

                            <!-- implements the messages that allow people to 
                                 subscribe -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Subscribe</nmwg:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Renew</nmwg:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Unsubscribe</nmwg:parameter>
      
                            <!-- Topics I am willing to publish to my direct 
                                 subscribers-->
                        <nmtb:parameter name="keyword:topic">idc:INFO</nmwg:parameter>  
                        <nmtb:parameter name="keyword:topic">idc:DEBUG</nmwg:parameter>
                        <nmtb:parameter name="keyword:topic">idc:ERROR</nmwg:parameter> 
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>

        </nmtb:service>
    </dcn:subject>
</nmwg:metadata>
}}}

===  Example 2 ===

An example showing the IDC and NB as being completely seperate.

{{{
<nmwg:metadata xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"
               id="meta1">

    <dcn:subject xmlns:dcn="http://ggf.org/ns/nmwg/tools/org/dcn/1.0/">

        <nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/"
                      id="ogf:network:domain=internet2.edu:node=test-idc:service=OSCARS_IDC">
                    
            <nmtb:name>OSCARS IDC</nmtb:name>
            <nmtb:description>OSCARS IDC, Ann Arbor, MI USA</nmtb:description>
        
                <!-- need something better here... -->
            <nmtb:type>IDC</nmtb:type>

                <!-- IDC needs to advertise domains it controls -->
            <nmtb:relation name="controls">
                <nmtb:idRef type="domain">urn:ogf:network:domain=dcn.internet2.edu</nmtb:idRef>
            </nmtb:relation>

                <!-- The IDC can subscribe to the notifications of other IDCs/NBs (look for the 'notify' message below) -->
            <nmtb:relation type="subscriber">
                <!-- this seems more natural
                
                <nmtb:idRef type="service">ogf:network:domain=es.net:node=test-idc:service=OSCARS_IDC</nmtb:idRef>

                -->
            
                <!-- this works just as well, i guess (can just do a lookup on the above) -->
                <nmtb:address type="uri">https://test-idc.es.net:7564/axis2/services/OSCARS</nmtb:address>
            </nmtb:relation>

                <!-- The IDC can publish (push) notifications to some external service (instead of being its own NB) -->
            <nmtb:relation type="publisher">
                <!-- this seems more natural
                
                <nmtb:idRef type="service">ogf:network:domain=internet2:node=test-idc:service=OSCARS_NB</nmtb:idRef>

                -->
            
                <!-- this works just as well, i guess (can just do a lookup on the above) -->
                <nmtb:address type="uri">https://test-idc.internet2.edu:2345/axis2/services/OSCARSNotificationBroker</nmtb:address>
            </nmtb:relation>

                <!-- First indicate that we are running on the TCP Port -->
            <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_8443">
                <nmtb:address type="uri">tcp://207.75.164.204:8443</nmtb:address>
            </nmtb:port>

                 <!-- Even though we are using the same endpoint, we want to advertise
                      the port two times (hacky...) -->

            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:8443/axis2/services/OSCARS</nmtb:address>

                <nmtb:relation name="runsOn">
                    <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_8443</nmtb:idRef>
                </nmtb:relation>

                <nmtb:protocol>
                        <!-- TBD pending DICE meeting ... 
                    
                        http://dice.controlplane.net/idc ?
                    
                        -->
                    <nmtb:type>http://oscars.es.net/OSCARS</nmtb:type>

                    <nmtb:parameters>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#createReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#modifyReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#cancelReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#createPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#refreshPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#teardownPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#queryReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#listReservations</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#getNetworkTopology</nmtb:parameter>
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>

            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:8443/axis2/services/OSCARS</nmtb:address>

                <nmtb:relation name="runsOn">
                    <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_8443</nmtb:idRef>
                </nmtb:relation>
    
                <nmtb:protocol>
                        <!-- TBD pending DICE meeting ... 
                    
                        http://dice.controlplane.net/nb ?
                    
                        -->
                    <nmtb:type>http://docs.oasis-open.org/wsn/b-2</nmtb:type>

                    <nmtb:parameters>
                            <!-- It accepts Notify messages from other services to 
                                 which it's subscribed, note look for the 'subscriber' above to see if we need this... -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Notify</nmwg:parameter>
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>

        </nmtb:service>
    </dcn:subject>
</nmwg:metadata>



<nmwg:metadata xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"
               id="meta1">

    <dcn:subject xmlns:dcn="http://ggf.org/ns/nmwg/tools/org/dcn/1.0/">

        <nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/"
                      id="ogf:network:domain=internet2.edu:node=test-idc:service=OSCARS_NB">
                    
            <nmtb:name>OSCARS NB</nmtb:name>
            <nmtb:description>OSCARS NB, Ann Arbor, MI USA</nmtb:description>
        
                <!-- need something better here... -->
            <nmtb:type>NB</nmtb:type>


                <!-- The NB is subscribed to IDCs (opposite of the above publisher) -->
            <nmtb:relation type="subscriber">
                <!-- this seems more natural
                
                <nmtb:idRef type="service">ogf:network:domain=internet2.edu:node=test-idc:service=OSCARS_IDC</nmtb:idRef>
                <nmtb:idRef type="service">ogf:network:domain=es.net:node=test-idc:service=OSCARS_IDC</nmtb:idRef>
                -->
            
                <!-- this works just as well, i guess (can just do a lookup on the above) -->
                <nmtb:address type="uri">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="uri">https://test-idc.es.net:4837/axis2/services/OSCARS</nmtb:address>
            </nmtb:relation>

                <!-- First indicate that we are running on the TCP Port -->
            <nmtb:port id="urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_2345">
                <nmtb:address type="uri">tcp://207.75.164.204:2345</nmtb:address>
            </nmtb:port>

            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:2345/axis2/services/OSCARSNotificationBroker</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:2345/axis2/services/OSCARSNotificationBroker</nmtb:address>

                <nmtb:relation name="runsOn">
                    <nmtb:idRef type="port">urn:ogf:network:domain=internet2.edu:node=test-idc:port=tcp_2345</nmtb:idRef>
                </nmtb:relation>
    
                <nmtb:protocol>
                        <!-- TBD pending DICE meeting ... 
                    
                        http://dice.controlplane.net/nb ?
                    
                        -->
                    <nmtb:type>http://docs.oasis-open.org/wsn/b-2</nmtb:type>

                    <nmtb:parameters>
                            <!-- It accepts Notify messages from other services to 
                                 which it's subscribed, note look for the 'subscriber' above to see if we need this... -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Notify</nmwg:parameter>

                            <!-- implements the messages that allow people to 
                                 subscribe -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Subscribe</nmwg:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Renew</nmwg:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Unsubscribe</nmwg:parameter>
      
                            <!-- Topics I am willing to publish to my direct 
                                 subscribers-->
                        <nmtb:parameter name="keyword:topic">idc:INFO</nmwg:parameter>  
                        <nmtb:parameter name="keyword:topic">idc:DEBUG</nmwg:parameter>
                        <nmtb:parameter name="keyword:topic">idc:ERROR</nmwg:parameter> 
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>

        </nmtb:service>
    </dcn:subject>
</nmwg:metadata>
}}}


=== Example 3 ===

{{{
<nmwg:metadata xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"
               id="meta1">

    <dcn:subject xmlns:dcn="http://ggf.org/ns/nmwg/tools/org/dcn/1.0/">

        <nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/"
                      id="ogf:network:domain=internet2.edu:node=test-idc:service=OSCARS_IDC">
                    
            <nmtb:name>OSCARS IDC</nmtb:name>
            <nmtb:description>OSCARS IDC, Ann Arbor, MI USA</nmtb:description>
            <nmtb:type>IDC</nmtb:type>

            <nmtb:relation name="controls">
                <nmtb:idRef type="domain">urn:ogf:network:domain=dcn.internet2.edu</nmtb:idRef>
            </nmtb:relation>

                <!-- publisher to itself -->
            <nmtb:relation type="publisher">
                <nmtb:address type="uri">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
            </nmtb:relation>

            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:8443/axis2/services/OSCARS</nmtb:address>

                <nmtb:protocol>
                    <nmtb:type>http://oscars.es.net/OSCARS</nmtb:type>

                    <nmtb:parameters>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#createReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#modifyReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#cancelReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#createPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#refreshPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#teardownPath</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#queryReservation</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#listReservations</nmtb:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://oscars.es.net/OSCARS#getNetworkTopology</nmtb:parameter>
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>
        </nmtb:service>
    </dcn:subject>
</nmwg:metadata>

<nmwg:metadata xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"
               id="meta1">

    <dcn:subject xmlns:dcn="http://ggf.org/ns/nmwg/tools/org/dcn/1.0/">

        <nmtb:service xmlns:nmtb="http://ogf.org/schema/network/base/20070828/"
                      id="ogf:network:domain=internet2.edu:node=test-idc:service=OSCARS_IDC">
                    
            <nmtb:name>OSCARS IDC</nmtb:name>
            <nmtb:description>OSCARS IDC, Ann Arbor, MI USA</nmtb:description>
            <nmtb:type>IDC</nmtb:type>

                <!-- opposite of the pub above + some other idc-->
            <nmtb:relation type="subscriber">
                <nmtb:address type="uri">https://test-idc.es.net:7564/axis2/services/OSCARS</nmtb:address>
            </nmtb:relation>

            <nmtb:port>
                <nmtb:address type="url">https://test-idc.internet2.edu:8443/axis2/services/OSCARS</nmtb:address>
                <nmtb:address type="url">http://[2001:468:1420:3:214:22ff:fe72:8ae6]:8443/axis2/services/OSCARS</nmtb:address>

                <nmtb:protocol>
                    <nmtb:type>http://docs.oasis-open.org/wsn/b-2</nmtb:type>

                    <nmtb:parameters>
                            <!-- It accepts Notify messages from other services to 
                                 which it's subscribed, note look for the 'subscriber' above to see if we need this... -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Notify</nmwg:parameter>

                            <!-- implements the messages that allow people to 
                                 subscribe -->
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Subscribe</nmwg:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Renew</nmwg:parameter>
                        <nmtb:parameter name="keyword:supportedMessage">http://docs.oasis-open.org/wsn/b-2#Unsubscribe</nmwg:parameter>
      
                            <!-- Topics I am willing to publish to my direct 
                                 subscribers-->
                        <nmtb:parameter name="keyword:topic">idc:INFO</nmwg:parameter>  
                        <nmtb:parameter name="keyword:topic">idc:DEBUG</nmwg:parameter>
                        <nmtb:parameter name="keyword:topic">idc:ERROR</nmwg:parameter> 
                    </nmtb:parameters>        
                </nmtb:protocol>
            </nmtb:port>

        </nmtb:service>
    </dcn:subject>
</nmwg:metadata>
}}}

= Open Questions =