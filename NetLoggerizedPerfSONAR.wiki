= Introduction =

This page describes how to turn on the [http://acs.lbl.gov/NetLoggerWiki NetLogger] Instrumentation in perfSONAR.

= Details =

Several of the core perfSONAR components have had NetLogger instrumentation added to them. The overhead of turning on NetLogger is slightly less than running the programs in DEBUG mode.

To active this instrumentation, add something like this to your logger.conf file:

{{{
#uncomment to enable NetLogger instrumentation
log4perl.category.NetLogger=DEBUG, A2
log4perl.appender.A2=Log::Dispatch::FileRotate
# roll over log files when they reach 16MB, and only keep 5 of them
log4perl.appender.A2.size=16777216
log4perl.appender.A2.max=5
log4perl.appender.A2.filename=/var/log/perfSONAR/hLS.netlogger.log
log4perl.appender.A2.mode=append
log4perl.appender.A2.layout=Log::Log4perl::Layout::PatternLayout
log4perl.appender.A2.layout.ConversionPattern=%m%n
}}}

== Useful NetLogger Tools ==

This simplest way to extract NetLogger timing info is to use the tool nl_interval. For example:

{{{
 nl_interval logfile | sort -n -k 3 -r  | more
 nl_interval -r -t hist logfile
}}}

You also might want to just look at the events or a particular guid. For example:
{{{
 # find guid of top level event of interest
 grep clientRequest.start netlogger.log | more
 # extract only events for this guid
 grep AE7078F2-EE97-11DE-A71F-D1694B559BB9 netlogger.log > timing.out
}}}

If you want to plot the results in excel or gnuplot, the -t csv" option to nl_interval may be useful.

You might also try nl_view:

{{{
 nl_view -g -d r.log  | grep "^ *5\."
}}}

== Adding Additional Instrumentation ==

When doing performance analysis with NetLogger, often you'll want to add additional NetLogger calls to zero in on the performance bottleneck. NetLogger adds very little overhead, so there is no harm adding additional calls.

Some good examples for how to add NetLogger calls can be found in Shared/lib/perfSONAR_PS/Transport.pm.
Just look for all instances of "NETLOGGER" and "NetLogger" in that file.

== NetLogger Tools installation quickstart ==

To install nl_interval and other useful tools:
   
{{{
 svn co https://bosshog.lbl.gov/repos/netlogger/trunk/python NetLogger
 cd NetLogger
 python setup.py install
}}}

== Dealing with Log Rotation ==

To combine a set of numbered log file in timestamp order for NetLogger analysis, use something
like this:
{{{
#!/bin/csh 
set echo
touch hLS-all.log
set c=400
while ( $c >= 1 )
     cat hLS.netlogger.log.$c >> hLS-all.log
     @ c = $c - 1
end
}}}