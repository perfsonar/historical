= OWAMP Data Summarization =

OWAMP is a tool that measures one-way delay. Tools such as the perfSONAR-PS toolkit allow one to configure OWAMP tests that constantly collect multiple one-way delay measurements every second. By default, the perfSONAR-PS toolkit collects these measurements at a rate of 10 per second (i.e. 600 per minute => 36000 per hour => 864,000 per day, etc). The number of measurements can add-up quickly and as a result the perfSONAR tools that collect these measurements provide a facility to summarize the data so it can be more easily consumed. 

Summarization is done by categorizing each individual measurement into groups referred to as *buckets* and reporting how many measurements fall into each bucket. The decision of which bucket to place an individual measurement is done by rounding the one-way delay result to a certain level of accuracy and putting all measurements with the same rounded value into the same bucket. The level of accuracy is defined by a value referred to as the *bucket_width*. The bucket width is represented as a decimal number that expresses the level of accuracy relative to one second (e.g. .001=1ms, .000001=1us, etc). The default value on the perfSONAR Toolkit and on networks like ESnet is .0001. Another way to demonstrate this is by saying given a bucket value X and a bucket_width Y, then X*Y = the rounded number of seconds each member of the bucket returned as the delay. 

As an example let's say one sends 10 packets in a minute that return the delay values in the table below and have a bucket_width set to .001. By doing `ceil([One-way Delay]/[bucket_width])` one can summarize each packet and its associated bucket value in the table below:

|| Packet # || One-way Delay || Bucket ||
|| 1 || .0174112 || 18 ||
|| 2 || .0184112 || 19 ||
|| 3 || .0175342 || 18 ||
|| 4 || .0170999 || 18 ||
|| 5 || .0183210 || 19 ||
|| 6 || .0188888 || 19 ||
|| 7 || .0177777 || 18 ||
|| 8 || .0181234 || 19 ||
|| 9 || .0192121 || 20 ||
|| 10 || .0193333 || 20 ||

We could present this distribution in its summary form in a table as follows:

|| Bucket || Count ||
|| 18 || 4 ||
|| 19 || 4 ||
|| 20 || 2 ||

Alternatively we could present this data graphically as a histogram:

http://perfsonar-ps.googlecode.com/svn/wiki/OWAMPDataSummarization/histo_example.png

perfSONAR returns this as XML which would like the following:
{{{
<summary:value_buckets>
    <summary:value_bucket value="18" count="4" />
    <summary:value_bucket value="19" count="4" />
    <summary:value_bucket value="20" count="2" />
</summary:value_buckets>
}}}

== TTL ==
In addition to the one-way delay buckets, the perfSONAR tools can also summarize the time-to-live (TTL) values returned by OWAMP. The TTL is an 8-bit field set in the I{ header of a packet that is decremented by every router in a path. By default owamp sets the TTL to its maximum value (255) and records the value when it reaches the destination. By subtracting the recorded value from 255 one can determine the number of routers in the path between the source and destination. If two tests record different TTL values, then that indicates that they took different paths (NOTE: just because two paths have the same TTL does not necessarily mean they took the same path, just that they took paths with an equal number of hops).  The method for organization TTL buckets is to simply sort the results based the value returned (i.e. no rounding). 

For example, if we send 10 packets and 5 report a TTL of 250 (5 hops) and 5 report a TTL of 249 (6 hops) we'd have a summary like the following:

|| Bucket || Count ||
|| 249 || 5 ||
|| 250 || 5 ||

Alternatively we could present this data graphically as a histogram:

http://perfsonar-ps.googlecode.com/svn/wiki/OWAMPDataSummarization/ttl_histo_example.png

perfSONAR returns this as XML which would like the following:
{{{
<summary:TTL_buckets>
    <summary:TTL_bucket ttl="249" count="5" />
    <summary:TTL_bucket ttl="250" count="5" />
</summary:TTL_buckets>
}}}

= Calculating Common Statistical Measures from Buckets =
The summary data above can be used to calculate common statistical measures such as min, max, median, and inter-quartile range. The examples in the sections that follow will use the summary from the one-way delay example above, which is copied here for convenience:

|| Bucket || Count ||
|| 18 || 4 ||
|| 19 || 4 ||
|| 20 || 2 ||


== Min and Max ==
Min and max are perhaps the easiest of the measures to calculate. The minimum is calculated by reporting the smallest bucket value which in the example above is *18*. Given the bucket width of .001 this is actually 18 `*` .001s = *18ms*. Likewise the maximum value is 20 which can be expressed in milliseconds as 20 `*` .001s = *20ms*.

== Median ==
Calculating the median can be done by thinking of the buckets as a list. To do this sort the bucket values and list each bucket the number of times indicated in the count. The example above can be expressed as:

 * 18, 18, 18, 18, 19, 19, 19, 19, 20, 20

To calculate the median we simply need to find the middle value:

 * 18, 18, 18, 18, *19*, *19*, 19, 19, 20, 20
 
In this example the median is *19* or by using the bucket_width to calculate in milliseconds 19 `*` .001s = *19 ms*.

== Inter-Quartile Range ==
The inter-quartile range is the difference between the upper and lower quartiles. We must find these first before calculating the range. Finding this is very similar to calculating the median, and to start it helps to list the values:

 * 18, 18, 18, 18, 19, 19, 19, 19, 20, 20
 
We now split the list in half so we can calculate the quartiles:
 
 * *Lower Half:* 18, 18, 18, 18, 19
 * *Upper Half:* 19, 19, 19, 20, 20
 
To calculate the lower quartile, find the middle value of the lower half:
 
 * 18, 18, *18*, 18, 19
 
Likewise, for the upper quartile find the middle of the upper half:

 * 19, 19, *19*, 20, 20
 
Finally, calculate the difference between these to values to get the inter-quartile range:
 
  * 19 - 18 = *1*
    * 1 `*` .001s = 1ms

==Mean==
The mean is the average value. You can use the estimates to calculate a mean by summing the product of each value and its count then dividing by the sum of all the counts. Using the example, the caclulation would look like the following:

(18`*`4 + 19`*`4 + 20`*`2)/(4 + 4 + 2) = 188/10 = *18.8*

Finally, you can multiply the value by the bucket_width to get the correct units: 18.8 `*`.001 = *18.8ms*


= Full perfSONAR Example =
==Request==
{{{
<?xml version="1.0" encoding="UTF-8"?>

<nmwg:message type="SetupDataRequest" id="setupDataRequest1"
              xmlns:owamp="http://ggf.org/ns/nmwg/tools/owamp/2.0/"
              xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"
              xmlns:select="http://ggf.org/ns/nmwg/ops/select/2.0/"
              xmlns:nmwgt="http://ggf.org/ns/nmwg/topology/2.0/"
              xmlns:nmtm="http://ggf.org/ns/nmwg/time/2.0/">

  <!-- Note the eventType. This will return the delay buckets. -->
  <nmwg:metadata id="meta2" xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/">
    <nmwg:subject id="id">
      <nmwgt:endPointPair xmlns:nmwgt="http://ggf.org/ns/nmwg/topology/2.0/">
        <nmwgt:src value="198.124.252.130" type="ipv4" />
        <nmwgt:dst value="198.129.254.102" type="ipv4" />
      </nmwgt:endPointPair>
    </nmwg:subject>
    <nmwg:eventType>http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317</nmwg:eventType>
  </nmwg:metadata> 
  <nmwg:metadata id="meta2c" xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/">
    <select:subject id="sub2c" metadataIdRef="meta2" xmlns:select="http://ggf.org/ns/nmwg/ops/select/2.0/"/> 
    <select:parameters id="param2c" xmlns:select="http://ggf.org/ns/nmwg/ops/select/2.0/">      
      <nmwg:parameter name="startTime">1309279447</nmwg:parameter>
      <nmwg:parameter name="endTime">1309280347</nmwg:parameter>
    </select:parameters>
    <nmwg:eventType>http://ggf.org/ns/nmwg/ops/select/2.0</nmwg:eventType> 
  </nmwg:metadata>
  <nmwg:data id="data2" metadataIdRef="meta2c" xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/"/>

</nmwg:message>
}}}
==Response==
{{{
<?xml version="1.0"?>
<SOAP-ENV:Envelope xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">
  <SOAP-ENV:Header/>
  <SOAP-ENV:Body>
    <nmwg:message xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/" messageIdRef="setupDataRequest1" id="message.11018093" type="SetupDataResponse">
      <nmwg:metadata xmlns:nmwg="http://ggf.org/ns/nmwg/base/2.0/" id="metadata.15112743" metadataIdRef="meta2c">
        <owamp:subject xmlns:owamp="http://ggf.org/ns/nmwg/tools/owamp/2.0/" id="subject-125">
          <nmwgt:endPointPair xmlns:nmwgt="http://ggf.org/ns/nmwg/topology/2.0/">
            <nmwgt:src value="198.124.252.130" type="ipv4"/>
            <nmwgt:dst value="198.129.254.102" type="ipv4"/>
          </nmwgt:endPointPair>
        </owamp:subject>
        <nmwg:eventType>http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317</nmwg:eventType>
        <nmwg:parameters id="parameters-125">
          <nmwg:parameter name="count">108000</nmwg:parameter>
          <nmwg:parameter name="bucket_width">0.0001</nmwg:parameter>
          <nmwg:parameter name="schedule">
            <interval type="exp">0.1</interval>
          </nmwg:parameter>
        </nmwg:parameters>
      </nmwg:metadata>
      <nmwg:data metadataIdRef="metadata.15112743" id="data.17317764">
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214024" maxError="2.01166e-06" max_delay="0.022296" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:45:11.2916769897 UTC 2011" loss="0" startTime="Tue Jun 28 16:44:13.2435415090 UTC 2011" sent="600" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="281" value="215"/>
                <summary:value_bucket count="315" value="216"/>
                <summary:value_bucket count="1" value="217"/>
                <summary:value_bucket count="1" value="220"/>
                <summary:value_bucket count="1" value="222"/>
                <summary:value_bucket count="1" value="223"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.02141" maxError="2.01166e-06" max_delay="0.0242963" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:46:09.2317372317 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:45:11.3505780939 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="271" value="215"/>
                <summary:value_bucket count="313" value="216"/>
                <summary:value_bucket count="5" value="217"/>
                <summary:value_bucket count="1" value="218"/>
                <summary:value_bucket count="1" value="220"/>
                <summary:value_bucket count="2" value="223"/>
                <summary:value_bucket count="3" value="224"/>
                <summary:value_bucket count="1" value="226"/>
                <summary:value_bucket count="1" value="229"/>
                <summary:value_bucket count="1" value="231"/>
                <summary:value_bucket count="1" value="243"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.021421" maxError="2.01166e-06" max_delay="0.105593" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:47:11.455009077 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:46:09.2550730666 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="244" value="215"/>
                <summary:value_bucket count="329" value="216"/>
                <summary:value_bucket count="4" value="217"/>
                <summary:value_bucket count="6" value="218"/>
                <summary:value_bucket count="2" value="219"/>
                <summary:value_bucket count="1" value="220"/>
                <summary:value_bucket count="1" value="222"/>
                <summary:value_bucket count="1" value="223"/>
                <summary:value_bucket count="2" value="225"/>
                <summary:value_bucket count="1" value="230"/>
                <summary:value_bucket count="1" value="235"/>
                <summary:value_bucket count="1" value="237"/>
                <summary:value_bucket count="1" value="248"/>
                <summary:value_bucket count="1" value="257"/>
                <summary:value_bucket count="1" value="265"/>
                <summary:value_bucket count="1" value="267"/>
                <summary:value_bucket count="1" value="271"/>
                <summary:value_bucket count="1" value="299"/>
                <summary:value_bucket count="1" value="1056"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214119" maxError="2.01166e-06" max_delay="0.0252466" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:48:13.2936612580 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:47:11.633709180 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="242" value="215"/>
                <summary:value_bucket count="349" value="216"/>
                <summary:value_bucket count="3" value="217"/>
                <summary:value_bucket count="1" value="219"/>
                <summary:value_bucket count="1" value="221"/>
                <summary:value_bucket count="1" value="224"/>
                <summary:value_bucket count="1" value="228"/>
                <summary:value_bucket count="1" value="252"/>
                <summary:value_bucket count="1" value="253"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214086" maxError="3.01749e-06" max_delay="0.155219" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:49:12.198705048 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:48:13.3329853691 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="275" value="215"/>
                <summary:value_bucket count="317" value="216"/>
                <summary:value_bucket count="3" value="217"/>
                <summary:value_bucket count="1" value="220"/>
                <summary:value_bucket count="1" value="224"/>
                <summary:value_bucket count="1" value="237"/>
                <summary:value_bucket count="1" value="813"/>
                <summary:value_bucket count="1" value="1553"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214047" maxError="3.01749e-06" max_delay="0.0231085" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:50:13.711960582 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:49:12.403076288 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="279" value="215"/>
                <summary:value_bucket count="318" value="216"/>
                <summary:value_bucket count="1" value="225"/>
                <summary:value_bucket count="1" value="227"/>
                <summary:value_bucket count="1" value="232"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214128" maxError="2.01166e-06" max_delay="0.0246563" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:51:12.4059083239 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:50:13.1192803236 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="266" value="215"/>
                <summary:value_bucket count="326" value="216"/>
                <summary:value_bucket count="3" value="217"/>
                <summary:value_bucket count="1" value="218"/>
                <summary:value_bucket count="1" value="227"/>
                <summary:value_bucket count="1" value="246"/>
                <summary:value_bucket count="2" value="247"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214071" maxError="2.01166e-06" max_delay="0.0257945" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:52:14.1970643661 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:51:13.129834762 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="226" value="215"/>
                <summary:value_bucket count="362" value="216"/>
                <summary:value_bucket count="8" value="217"/>
                <summary:value_bucket count="1" value="221"/>
                <summary:value_bucket count="1" value="224"/>
                <summary:value_bucket count="1" value="239"/>
                <summary:value_bucket count="1" value="258"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214028" maxError="2.01166e-06" max_delay="0.0273614" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:53:14.3865684838 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:52:14.2176318057 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="259" value="215"/>
                <summary:value_bucket count="315" value="216"/>
                <summary:value_bucket count="5" value="217"/>
                <summary:value_bucket count="3" value="218"/>
                <summary:value_bucket count="1" value="220"/>
                <summary:value_bucket count="1" value="222"/>
                <summary:value_bucket count="1" value="223"/>
                <summary:value_bucket count="3" value="224"/>
                <summary:value_bucket count="2" value="225"/>
                <summary:value_bucket count="1" value="230"/>
                <summary:value_bucket count="1" value="233"/>
                <summary:value_bucket count="1" value="244"/>
                <summary:value_bucket count="1" value="246"/>
                <summary:value_bucket count="2" value="252"/>
                <summary:value_bucket count="1" value="254"/>
                <summary:value_bucket count="1" value="261"/>
                <summary:value_bucket count="1" value="269"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214162" maxError="2.01166e-06" max_delay="0.0243125" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:54:12.3949826123 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:53:15.9127381 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="240" value="215"/>
                <summary:value_bucket count="354" value="216"/>
                <summary:value_bucket count="3" value="217"/>
                <summary:value_bucket count="1" value="229"/>
                <summary:value_bucket count="1" value="237"/>
                <summary:value_bucket count="1" value="244"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214195" maxError="3.01749e-06" max_delay="0.0260601" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:55:16.2074271628 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:54:12.4189108163 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="248" value="215"/>
                <summary:value_bucket count="346" value="216"/>
                <summary:value_bucket count="3" value="217"/>
                <summary:value_bucket count="1" value="219"/>
                <summary:value_bucket count="1" value="238"/>
                <summary:value_bucket count="1" value="261"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214119" maxError="2.01166e-06" max_delay="0.0269799" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:56:16.1179932077 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:55:16.2101963127 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="267" value="215"/>
                <summary:value_bucket count="325" value="216"/>
                <summary:value_bucket count="1" value="217"/>
                <summary:value_bucket count="1" value="219"/>
                <summary:value_bucket count="1" value="223"/>
                <summary:value_bucket count="2" value="227"/>
                <summary:value_bucket count="1" value="232"/>
                <summary:value_bucket count="1" value="241"/>
                <summary:value_bucket count="1" value="270"/>
            </summary:value_buckets>
        </summary:datum>
        <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214028" maxError="2.01166e-06" max_delay="0.0258613" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:57:13.1210835635 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:56:16.2311188444 UTC 2011" maxTTL="251">
            <summary:value_buckets>
                <summary:value_bucket count="223" value="215"/>
                    <summary:value_bucket count="362" value="216"/>
                    <summary:value_bucket count="5" value="217"/>
                    <summary:value_bucket count="1" value="219"/>
                    <summary:value_bucket count="2" value="221"/>
                    <summary:value_bucket count="1" value="222"/>
                    <summary:value_bucket count="2" value="223"/>
                    <summary:value_bucket count="1" value="242"/>
                    <summary:value_bucket count="1" value="243"/>
                    <summary:value_bucket count="1" value="246"/>
                    <summary:value_bucket count="1" value="259"/>
                </summary:value_buckets>
            </summary:datum>
            <summary:datum xmlns:summary="http://ggf.org/ns/nmwg/characteristic/delay/summary/20110317/" minTTL="251" min_delay="0.0214176" maxError="2.01166e-06" max_delay="0.140428" timeType="iso" duplicates="0" endTime="Tue Jun 28 16:58:19.1840583463 UTC 2011" loss="0" sent="600" startTime="Tue Jun 28 16:57:13.1812923712 UTC 2011" maxTTL="251">
                <summary:value_buckets>
                    <summary:value_bucket count="263" value="215"/>
                    <summary:value_bucket count="316" value="216"/>
                    <summary:value_bucket count="6" value="217"/>
                    <summary:value_bucket count="2" value="218"/>
                    <summary:value_bucket count="1" value="222"/>
                    <summary:value_bucket count="1" value="226"/>
                    <summary:value_bucket count="2" value="228"/>
                    <summary:value_bucket count="1" value="229"/>
                    <summary:value_bucket count="1" value="231"/>
                    <summary:value_bucket count="1" value="237"/>
                    <summary:value_bucket count="1" value="238"/>
                    <summary:value_bucket count="1" value="243"/>
                    <summary:value_bucket count="1" value="245"/>
                    <summary:value_bucket count="1" value="645"/>
                    <summary:value_bucket count="1" value="725"/>
                    <summary:value_bucket count="1" value="1405"/>
                 </summary:value_buckets>
            </summary:datum>
        </nmwg:data>
    </nmwg:message>
    </SOAP-ENV:Body>
</SOAP-ENV:Envelope>
}}}