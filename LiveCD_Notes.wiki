#summary Notes on a transition to the CentOS LiveCD

= Notes on a transition to the CentOS LiveCD =

<wiki:toc max_depth="6" />

== Ramdisk ==

By default, all LiveCDs utilize a ramdisk to allow writes to the filesystem. There are two issues with this situation:

  * Ramdisk memory limitations: All the CDs that I've seen use a form of Ramdisk that does not allocate physical memory to support the size of the ramdisk. This means that if either memory or the ramdisk fill up, the ramdisk can no longer accept writes, and the OOM killer will start trying to kill random processes to reclaim space.
  * Use of RAM to store temporary files: We could fix the ramdisk limitations above by fixing the size of the ramdisk to something less than ram size, and pre-allocating RAM to support it. However, that has two downsides: it wastes RAM, and it limits the size of the writeable area to some percentage of the size of RAM.

Some LiveCD implementations offer the ability to have all writes go to disk (e.g. RedHat/CentOS or Ubuntu). On reboot, those changes are overlayed over the information on the ISO. This has the downside of making it significantly more difficult to handle upgrades. In the current toolkit, we whitelist what gets saved instead of saving everything. This makes upgrades significantly more tractable because we know exactly what is being saved, instead of having everything saved (which could include changes to binary files and the like).

In the current toolkit, we overlay the ramdisk with a file on disk (/mnt/store/NPTools/scratch) which forces all writes to go to the disk instead of the ramdisk which works around the two issues above. The scratch file gets re-initialized each time so that we throw away the old data. 

The current toolkit uses a "feature" of aufs, the module that provides the overlays, that allows us to overlay the ramdisk with the file on disk. Unfortunately, that feature is not possible in the new version of aufs, and it won't work with the CentOS live cd. 

Possible new version: the initrd.img file contains the init scripts that setup the ramdisk and the like. It might make sense to try and mount the backing store inside the initrd, and then setup the overlay to use the scratch file on disk if it exists. This would be more difficult than just adding a new RPM since we'd have to specifically modify the initrd, but it is likely cleaner, and may be the only way possible.

== Upgrade Path (configuration) ==
  * NDT/NPAD: We'll need to recreate the .html files (possibly to new location).
  * bwctl: copy the old bwctld.conf/bwctld.keys/bwctld.limits (possibly to new location).
  * owamp: copy the old owampd.conf/owampd.pfs/owampd.limits (possibly to new location).
  * perfSONARBUOY: reread the old configuration, and rewrite it (possibly in a new location)
  * PingER: reread the old configuration, and rewrite it (possibly in a new location)
  * ntp: copy old ntp.conf and known server list (possibly to new location)
  * passwd: make a list of all the system accounts on the knoppix version, pull anything that's not in that last, and add it to the new passwd file.
  * administrative info: copy the old data to the new
  * enabled services: copy the old data to the new

== Upgrade Path (data) ==
  * NDT/NPAD: It might be reasonable to just lose the old data as most folks don't seem to care about the tests. This would need to be something that we make clear to users. If someone wants to save the data, we could possibly come up with a workaround.
  * PingER: mysql may need to upgrade the tables if the version of MySQL is upgraded.
  * perfSONARBUOY: mysql may need to upgrade the tables if the version of MySQL is upgraded.
  * cacti: mysql may need to upgrade the tables if the version of MySQL is upgraded. The RRD files should be in the "correct" location. The location may need moved if desired.

== Last Modified ==

$Id$
