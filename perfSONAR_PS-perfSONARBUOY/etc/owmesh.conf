# owmesh.conf - Configuration file for scheduled test component of perfSONAR-BUOY
# $Id$

	# Do not change
BWSessionSuffix     .recv.bw
OWPSessionSuffix    .owp
DevNull             /dev/null

    # SummarySuffix is cat'd onto SessionSuffix
SummarySuffix		.sum

    # should not need to change these (names of the binaries)
BWCmd			bwctl
OWPCmd			powstream
SessionSumCmd   owstats -M

#################
#
# POSSIBLE CHANGE
#
#################
    # binary/location information.  Use this to specify if not found in $PATH
BWBinDir		/usr/bin
OWPBinDir		/usr/bin

    # could just say this if they are both the same
#BinDir          /usr/bin

#################
#
# POSSIBLE CHANGE
#
#################
	# These dirs MUST be in the same filesystem!
BWDataDir           /var/lib/perfsonar/perfsonarbuoy_ma/bwctl
BWCentralDataDir	/var/lib/perfsonar/perfsonarbuoy_ma/bwctl/upload
BWCentralArchDir	/var/lib/perfsonar/perfsonarbuoy_ma/bwctl/archive

OWPDataDir          /var/lib/perfsonar/perfsonarbuoy_ma/owamp
OWPCentralDataDir   /var/lib/perfsonar/perfsonarbuoy_ma/owamp/upload
OWPCentralArchDir   /var/lib/perfsonar/perfsonarbuoy_ma/owamp/archive
OwampdVarDir        /var/lib

	# Global in nature...shouldn't change
ConfigVersion		20080715.0
SecretNames		13Jul2009 15Jul2008 FallBack
SecretName		13Jul2009
13Jul2009		SayWhatAgainIDareYou
15Jul2008		AFestivusForTheRestOfUs
FallBack		TingsBeBerryBerryBadMon

    # Logging info
!Debug
!Verbose
SyslogFacility		local5

    # user:group info
UserName		perfsonar
GroupName		perfsonar

	# If set, only allow contact from CONTACTADDR's defined for each node
!VerifyPeerAddr
!BWVerifyPeerAddr
!OWPVerifyPeerAddr

#################
#
# POSSIBLE CHANGE
#
#################

	# read timeout on file upload socket.
BWCentralHostTimeout	3600
BWCentralHost           localhost:8570

OWPCentralHostTimeout   600
OWPCentralHost          localhost:8569
UpTimeSendToAddr        localhost:5434

	# Database info
!CentralDBHost
CentralDBType		DBI:mysql
CentralDBUser		perfsonar
CentralDBPass		7hc4m1
BWCentralDBName 	bwctl
OWPCentralDBName	owamp

	# add a read only user so that the cgis have minimum privileges
CGIDBUser           readonly
CGIDBPass           readonly
CGITmpDir           /tmp
#Ploticus           /usr/bin/pl

    #
    # These define how the nms nodes deal with the uptime pairs on the local
    # side and how often they send the updates.
    #
UpTimeDBFile		liveupdate.db
    # How often to send uptime updates. (seconds)
UpTimeSendInterval	300
    # How many "pairs" of up/down times are send/saved.
UpTimeSendPairs		10
UpTimeMaxMesgLen	1024

	# connect/write/read timeout for sending socket (Can be set on a
	# per-node bases if needed.)
SendTimeout		60
SaveThreshold	25

	# Address types and descriptions
	# On Abilene, LAT addrs map to nms4-* and BW addrs map to nms1-*
	# On I2NET, LAT addrs map to nms-rlat and BW addrs map to nms-?thr?
ADDRTYPES   [[BW4 BW6 LAT4 LAT6]]

	# ADDRDESC is relative to 'node' so it can be over-ridden in NODE blocks
	# (Useful for specifying the ISP a given address is associated with.)
BW4ADDRDESC     IPv4 Throughput
BW6ADDRDESC     IPv6 Throughput
LAT4ADDRDESC    IPv4 Latency
LAT6ADDRDESC    IPv6 Latency


#######################################################################
# BWCTL Iperf-TCP Test Definition

<TESTSPEC=BWTCP_6HR>
DESCRIPTION                     6 Hour TCP Throughput (iperf)
TOOL                            bwctl/iperf

	# seconds - every 1 hour (on average)
BWTestInterval			21600

	# alpha - percentage to vary each start interval by. (ranomize 
	# +/- interval)
BWTestIntervalStartAlpha	25

	# seconds
BWReportInterval		2

	# TCP send/recv buffer size. (Might not be good to set for auto-scaling
	# kernels)
BWWindowSize			4M

	# do a tcp test
BWTCP

	# seconds
BWTestDuration		        60
</TESTSPEC>


<TESTSPEC=BWTCP_2MIN>
DESCRIPTION                     2 Minute TCP Throughput (iperf)
TOOL                            bwctl/iperf

	# seconds - every 1 hour (on average)
BWTestInterval			120

	# alpha - percentage to vary each start interval by. (ranomize 
	# +/- interval)
BWTestIntervalStartAlpha	25

	# seconds
BWReportInterval		1

	# TCP send/recv buffer size. (Might not be good to set for auto-scaling
	# kernels)
BWWindowSize			4M

	# do a tcp test
BWTCP

	# seconds
BWTestDuration		        10
</TESTSPEC>

#######################################################################
# OWAMP Test Definition
<TESTSPEC=LAT_1MIN>
DESCRIPTION     One-Way Latency
TOOL            powstream

# seconds
OWPINTERVAL     1
OWPLOSSTHRESH   1

# number of session packets
# 10800 is the number of seconds in 3 hours - with above 'interval'
# set to 0.1 - that means 108000 packets in a 3 hour session.
# Because powstream uses 2 control connections to stich together
# concurrent sessions to achieve continuous testing, 3 hour long
# individual sessions means our testing can survive ~6 hour
# network partitions.
OWPSESSIONCOUNT         100

# number of packets in a sample (see owstats -N )
# OWPSAMPLECOUNT MUST be an even multiple of OWPSESSIONCOUNT.
#
# Attempting to get a summary session ~ 1/minute. So, with the
# above 'interval' of 0.1 that means roughly 600 packets per minute.
OWPSAMPLECOUNT      10

# Amount of padding to add to minimally sized packets
!OWPPACKETPADDING

#
# This defines how the delay data is aggregated. (This is the width of
# the histogram buckets. (100 usecs)
OWPBUCKETWIDTH		0.0001

</TESTSPEC>

#################
#
# MUST CHANGE
#
#################

#######################################################################
# Host definitions, should equal the result of a `uname -a`, this is
#   how the master will determine which machine is running a test.  Its a good
#   idea to enter all machines that are involved in all tests here.

<HOST=clean-centos4*>
NODE	CENTOS_32_4
</HOST>

<HOST=clean-centos5*>
NODE	CENTOS_32_5
</HOST>

<HOST=clean-64centos5*>
NODE	CENTOS_64_5
</HOST>

#################
#
# MUST CHANGE
#
#################

#######################################################################
# Node Definitions, needed for each potential member of a mesh

<NODE=CENTOS_32_4>
LONGNAME	    CentOS 4 (32 Bit)
CONTACTADDR	    192.168.69.174
BW4ADDR	        192.168.69.174:4823
LAT4ADDR        192.168.69.174

# Note: this is the machine that is running the master/collector (e.g. the
#   center of the star), so we comment out the next part
#NOAGENT
</NODE>

# The next two are 'targets' of the test.  They are just running bwctl/owamp

<NODE=CENTOS_32_5>
LONGNAME	    CentOS 5 (32 Bit)
CONTACTADDR	    192.168.69.172
BW4ADDR	        192.168.69.172:4823
LAT4ADDR        192.168.69.172

# Slave - no agent
NOAGENT
</NODE>

<NODE=CENTOS_64_5>
LONGNAME	    CentOS 5 (64 Bit)
CONTACTADDR	    192.168.69.141
BW4ADDR	        192.168.69.141:4823
LAT4ADDR        192.168.69.141

# Slave - no agent
NOAGENT
</NODE>

#################
#
# MUST CHANGE
#
#################

#######################################################################
# Group Definition

<GROUP=TEST-STAR>
DESCRIPTION	    Testing of a star configuration
GROUPTYPE	    STAR

# Change the 'center' node, or 'hauptnode' here.  See the example above.  

HAUPTNODE	    CENTOS_32_4

# Add *all* nodes that pareticipate in the tests here

NODES	        [[ CENTOS_32_4 CENTOS_32_5 CENTOS_64_5 ]]

# Add another node in that will 'send' to HAUPTNODE
#INCLUDE_SENDERS
# Remove specific senders from the star - even HAUPTNODE (takes precedence)
#EXCLUDE_SENDERS
# Add another node in that will 'recv' from HAUPTNODE
#INCLUDE_RECEIVERS
# Remove specific receivers from the star - even HAUPTNODE (takes precedence)
#EXCLUDE_RECEIVERS
</GROUP>

#######################################################################
# Measurement Sets

<MeasurementSet=CENTOS5-BWTCP4>
DESCRIPTION	    Star Testing - 2 Minute TCP Throughput (iperf)
ADDRTYPE	    BW4
GROUP	        TEST-STAR
TESTSPEC	    BWTCP_2MIN
EXCLUDE_SELF
</MeasurementSet>

<MeasurementSet=CENTOS5-LAT4>
DESCRIPTION	    Star Testing - 1 Minute Latency
ADDRTYPE        LAT4
GROUP	        TEST-STAR
TESTSPEC        LAT_1MIN
</MeasurementSet>
