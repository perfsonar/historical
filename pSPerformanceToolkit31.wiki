#summary pS Performance Toolkit 3.1

<wiki:toc max_depth="6" />

== Introduction ==

The following guide describes in detail the steps required to set up version 3.1 of the perfSONAR performance Toolkit ([http://internet2.edu/performance/pS-PerformanceToolkit/ pS Performance Toolkit 3.1]).  It is important to follow each step in order.  Upon getting stuck, consult the [pSPerformanceToolkit31#FAQ FAQ] at the end of this document.  

== System Requirements ==

The pS Performance Toolkit requires modern hardware to function properly.  The following are basic guidelines to selecting hardware to power the measurement tools.

 * _*CPU*_
   * x86 or x86_64 Architecture
   * _*Single Core*_
     * 2.4Ghz or better
   * _*Dual Core*_
     * 1.6Ghz or better
 * _*Main Memory*_
   * 1G or better
 * _*Disk Size*_
   * 100G or better
 * _*Network Card*_
   * External NIC prefered to NIC located on the Motherboard
   * Speed depends on intended use
   * NIC choice is dependent on Linux driver availability, suggestions:
     * Intel Chipset (uses the e1000 driver)
       * PRO/1000 PT PCI-Express
       * PRO/1000 MT PCI-X.
       * PRO/1000 GT
     * Linksys/Netgear (uses the ns83820 driver)
       * 1GE PCI-X card
     * Myricom 10G Cards
       * Up to date drivers with each pS Performance Toolkit Release

Further recommendations for specific test situations and environments are available below.  These should be used to supplement the basic information.  

=== Virtual Machines ===

Use of the pS Performance Toolkit as a virtual machine is not recommended.  Due to the emulation of virtual hardware, measurement tools may not feature a completely accurate result.  Observations have shown the following tools and services behave in unexpected ways when used in a VM environment:

 * _*NTP*_: Virtual Machines (depending on software implementation) may receive a clock signal from the host they are running upon.  This may be delayed and is never as accurate as a true hardware clock; because of this NTP can suffer high jitter and delay characteristics.
 * _*OWAMP*_: OWAMP depends on accurate NTP results to properly measure the packets used in testing.  
 * _*BWCTL*_: BWCTL depends on accurate NTP results to properly measure the packets used in testing.  Additionally, virtual NIC support does not deliver the maximum available bandwidth as the guest machine often must fight with the host for access to the physical network.  

=== Throughput Recommendations === 

Long term storage of throughput data will require more disk space than recommended in the base.  We recommend upping the size of the primary disk to greater than or equal to 200G.  

Minimization of _*Jitter*_ is a common goal when performing latency tests.  In general most CPU and Motherboard combinations work well on modern hardware.   It is also *highly recommended* that combination Motherboard and NIC be avoided.

=== Bandwidth Recommendations === 

Bandwidth testing often requires that the CPU, Motherboard, and Network card work in harmony to achieve promised speeds.  Testing has shown that using a CPU (Single or Dual Core) with a higher clock speed will work better when managing the needs of the rest of the machine during bandwidth testing.  It is also *highly recommended* that combination Motherboard and NIC be avoided.  

=== First Steps ===

  # Download the the latest from:
    * [http://software.internet2.edu/pS-Performance_Toolkit/pS-Performance_Toolkit-3.1rc1.iso]
    * [http://software.internet2.edu/pS-Performance_Toolkit/pS-Performance_Toolkit-3.1rc1.iso.md5]
  # Verify the MD5 sum:
    * md5sum -c pS-Performance_Toolkit-3.1rc1.iso 
  # Burn the ISO to a CD-ROM
  # Configure the computer to boot from CD
    * This may require changes to the computer's BIOS to ensure the CD is recognized before an existing harddisk
    * The BIOS may be entered when the computer boots by using a key combination (*F12* in some cases, *Del* in others - consult a manual if unsure or pay close attention to the boot process to enter _setup_).  
  # Insert the CD-ROM into the tray and boot the system
    * The computer will boot with some typical messages, after this it will enter the boot and customization process.
      * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/BootScreen_1.png
    * The boot process will proceed after this screen where typical Linux startup messages will be seen.  This may take some time, particularly to resolve the host address and set up basic networking.  If all goes well, a login prompt will appear.  
      * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/LoginPrompt_2.png

=== Console Configuration ===

There are several important steps that must be configured via the console.  The instructions for each is outlined below.  Note that this process differs from the historic instructions for previous releases.  

==== Step 1 - System Ready ==== 

The first step is to login to the system.  The username that begins the process is _*knoppix*_.  The password will vary depending on the environment:

 * If this is the _*first time*_ the system is being setup (e.g. no prior use for the pS Performance Toolkit) the password will be blank.  
 * If this system has been used for for the pS Performance toolkit prior (or the NPToolkit) the _*knoppix*_ user will contain the password previously configured.
 
An image of the system after login is pictured below:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/LoggedIn_3.png
 
Note that the _*knoppix*_ user has sudo permission.  The console is now fully functional and the system, in practice, is ready to perform simple network diagnostic and measurement tasks:

 * NPAD is started
 * NDT is started
 * The BWCTL daemon is started
 * The OWAMP daemon is started
 * Apache is running, and all web content (e.g. pS Performance Toolkit Administration, Reverse Traceroute, Cacti) are available. 
 
The system is not perfSONAR enabled unless steps are taken to customize and configure some of the tools.  

==== Step 2 - Menu Options ==== 

After login, the _Message of the Day_ (_*MOTD*_) is configured to display information on configuration.  The console configuration can be accomplished by running:

 * _*sudo nptoolkit-configure.py*_
 
If this is your first time invoking sudo, it may be necessary to enter the _*knoppix*_ user's password:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu_4.png

As shown in the image, a menu will appear describing configuration options:

 # Configure drive to hold data/customizations
 # Set built-in account passwords
 # Manage Users
 # Configure Networking
 # Change Timezone

The following steps will describe configuration of each.  Note that a color scheme is used to help quickly identify customizations:

 * <font color="red">RED</font> - Required configuration step
 * <font color="purple">MAGENTA</font> - Optional configuration step (not completed)
 * <font color="green">GREEN</font> - Completed step
 * <font color="gray">GRAY</font> - Neutral step (neither required nor optional)

==== Step 3 - Storage Configuration ==== 

To take advantage of many of the perfSONAR tools a storage device must be present to store measurement data.  In most situations the internal hard drive (or optionally an external storage device such as a USB thumb drive) should be configured to perform this task.  

Selecting _*Option 1*_ in the menu will start the configuration process:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu-DriveOptions1_5.png

After selecting a drive to use it may be necessary to format the drive (if no filesystem is preset or the file system is unreadable):

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu-DriveOptions1_6.png

After completing the menu will indicate this step has been visited.   Also note that a *Reboot* will be required after adjusting the disk configuration. 

==== Step 4 - User Passwords ==== 

To configure the passwords for the existing users (_*knoppix*_ and _*root*_) _*Option 2*_ is used:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu-Passwd_7.png

==== Step 5 - User Management ==== 

Adding new users to the system (beyond _*knoppix*_ and _*root*_) is completed in _*Option 3*_:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu-Users_8.png

==== Step 6 - Networking Options ==== 

To adjust the networking options of the host (e.g. static vs dynamic address, hostname, advertised interface) use _*Option 4*_:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu-Network_9.png

==== Step 7 - Timezone Options ==== 

Changing the timezone of the system (currently set to Eastern Time) use _*Option 5*_:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ConfigureMenu-TimeZone_10.png

==== Final Step ==== 

Also note that a *Reboot* will be required once this menu is exited if any changes were made to the disk configuration.  

=== Web Configuration ===

This version of the pS Performance Toolkit features a web-based _wizard_ interface for configuring many aspects of the system.  The following sections describe each option.

==== Access Control ====

Several screens in the web interface are password protected, and a user with appropriate privledges must be entered:

 * _*root*_: *cannot* log in through the web interface
 * _*knoppix*_: can log in - provided the password has been set
 * _*others users*_: can log in - provided the password has been set and they they are in the _*admin*_ group as specified in [pSPerformanceToolkit31#Step_5_-_User_Management User Management]

Steps that require a password will be noted.  

==== Step 1 - Services On This Node ==== 

When visiting the the toolkit via web browser (HTTP or HTTPS) the following screen will be visible:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/Home_11.png

Note that your experience may vary, some services may not be active due to configuration reasons or unrelated errors.  As the configuration proceeds these services may restart automatically based on user actions.  This screen acts as the _dashboard_ for configuring information or viewing measurement data on this host.  Some important things to note:

 * When viewing with a web browser, a security certificate warning may be triggered.  The HTTPS certificate is not signed by a trusted source.
 * Some sections require a password to edit/view
 * Many pages are static: if a setting is changed in another window (or by another user), refreshing or hitting the _*Reset*_ button present on some pages is necessary.  

==== Step 2 - Global Set of Services ==== 

The pS Performance Toolkit contains software that interacts with the perfSONAR Global Lookup Service.  This page represents a snapshot of the current set of perfSONAR services world wide:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_12.png

Some things to note about this GUI:

 * An internal process builds the cached list once every 30 minutes - this is not a live view
 * Your service may take several hours to appear in the list
 * Due to R&E network seperation from the commercial internet it is not always possible to _reach_ every service in the list
 * Firewalls may block access to certain services

==== Step 3 - JOWPing Interface ==== 

JOWPing is a Java-based OWAMP tool.  Note that to work properly both the service (your pS Performance Toolkit) and the client (someone's web browser) must be on machines that:

 * Are not blocking key firewall ports (e.g. 861) or are NAT'ed
 * Have a stable time source (e.g. NTP)
 * Are Java capable

An image of the tool is pictured below:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/JOWPing_13.png

==== Step 4 - Administrative Information ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

The pS Performance Toolkit has several perfSONAR services, many of which will not function unless properly configured.  The Administrative Information screen allows the user to enter information:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/AdminInfo_14.png

After saving (at the bottom of the page) the information will stick around:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/AdminInfoFilled_15.png

===== Communities ===== 

Selecting which _*communities*_ to identify this installation can be confusing to answer for new users.  This particular question is trying to associate some _loosely coupled_ labels to the data that the perfSONAR NPToolkit disk will be making available to the larger world.  Think of this step similar to assigning labels to photos or music (e.g. a photo of a dog might have labels: _Dog_, _Rover_, etc. but someone else may choose different labels).  In general there is no _wrong way_ to choose a keyword.  Choose keywords that best describe the circumstances that surround this installation.  

Some examples of valid answers are:

 * *Internet2* - The data made available somehow connects the Intesrnet2 backbone
 * *LHC* (*CMS*, *ATLAS*, etc.) - The disk is part of the LHC deployment structure
 * *eVLBI* - The disk is a part of the larger telescope community
 * *MAX* - A connector of member of the MAX gigapop

We would recommend choosing keywords that:

 * Describe the location/installation (e.g. the name of the organization installing): *MCNC*, *UDel*
 * Network connections: *ESnet*, *GEANT*, *Internet2*, *NLR*, *RNP*
 * Virtual Organizations (VOs): *CMS*, *ATLAS*

Use as many community names as necessary to properly categorize the data from the installation.

==== Step 5 - BWCTL Limits ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

To limit the access to the BWCTL tool, a screen that allows restrictions to be placed on access is available:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/BWCTLLimits_16.png

==== Step 6 - OWAMP Limits ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

To limit the access to the OWAMP tool, a screen that allows restrictions to be placed on access is available:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/OWAMPLimits_17.png

==== Step 7 - Enabled Services ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

Services on the disk (e.g. NTP, SSH, HTTP) can be enabled and disabled via this screen:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/EnabledServices_18.png

Note that if a service is _disabled_ it will be stopped immediately and will not start on boot.  

==== Step 8 - NTP Configuration ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

To select alternative NTP services, visit this screen:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/NTP_19.png

NTP configuration should consist of:

 * 4-5 Servers (for redudency and to help the NTP algorithms make _good_ choices)
 * Of a similar _stratum_ (e.g. all Stratum 1, or all Stratum 2)
 * Geographically _close_ (within the same timezone is a safe assumption)
 * On divergent network paths (prevents problems with failed network paths or asymetric congestion)

==== Step 9 - Scheduled Testing ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

There are three types of scheduled testing available on the pS Performance Toolkit:

 # BWCTL (Throughput)
 # Ping (Two Way Latency)
 # OWAMP (One Way Latency)

An image of the configuration screen is shown below:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/Scheduled_20.png

Note that as tests are configured, they will appear on this screen where they can be edited or deleted.  The BWCTL configuration screen is shown first:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ScheduledBWCTL1_21.png

The user should enter descriptive values for fields such as _description_ and should choose test parameters that are _meaningful_.  For instance a 10 second BWCTL test may not reveal much about the true performance of a network due to the nature of TCP.  For TCP to stabilize it requires a longer amount of time (30 - 60 seconds).  Do note that a longer test _consumes_ some of the host resources (e.g. it cannot run more than one test at a time, CPU/Memory will be consumed during the test).  In general we recommend:

 # > 10 second tests
 # Spaced > 30 minutes apart
 # Do not consume more than 80% of the _schedule_, this allows time for _on-demand- testing that others may wish to initiate.

Hosts to test will may be manually entered (recommended) or the perfSONAR Information Services can be used to _locate_ test hosts that match criteria (e.g. in the same _Community_, etc.).  The following screen shows adding a host.

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ScheduledBWCTL2_22.png
 
Adding tests for the other measurement types works in the same way, first Ping: 
 
 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ScheduledPing1_23.png
 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ScheduledPing2_24.png
 
Lastly, OWAMP: 
 
 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ScheduledOWAMP1_25.png
 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/ScheduledOWAMP2_26.png

==== Step 10 - Cacti Administration ==== 

<font color=red size=-1>This screen is password protected, see [pSPerformanceToolkit31#Access_Control Access Control] for more information.</font>

Consult [http://cacti.net/ documentation for the Cacti tool] for instructions on use.  

==== Step 11 - Throughput Results ==== 

After setting up regular BWCTL testing (See [pSPerformanceToolkit31#Step_9_-_Scheduled_Testing Scheduled Testing]) and waiting for results to be gathered (time may vary), this screen can be consulted:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_BWCTL_27.png

Clicking on one of the host pairs and selecting a time range will display a graph:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_BWCTL_Graph_28.png

==== Step 12 - One Way Latency Results ==== 

After setting up regular OWAMP testing (See [pSPerformanceToolkit31#Step_9_-_Scheduled_Testing Scheduled Testing]) and waiting for results to be gathered (time may vary), this screen can be consulted:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_OWAMP_29.png

Clicking on one of the host pairs and selecting a time range will display a graph:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_OWAMP_Graph_30.png

==== Step 13 - Ping Results ==== 

After setting up regular Ping testing (See [pSPerformanceToolkit31#Step_9_-_Scheduled_Testing Scheduled Testing]) and waiting for results to be gathered (time may vary), this screen can be consulted:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_PingER_31.png

Clicking on one of the host pairs and selecting a time range will display a graph:

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/perfAdmin_PingER_Graph_32.png

==== Step 13 - SNMP Results ==== 

TBD

==== Step 14 - Cacti Graphs ==== 

TBD

 * http://perfsonar-ps.googlecode.com/svn/wiki/pSPerformanceToolkit31/Cacti_33.png

== Known Bugs ==

=== Upgrade does not create new MySQL databases ===

*Symptom*: After configuring OWAMP tests, the _*perfSONAR-BUOY Regular Testing (One-Way Latency)*_ section may be in a _*Not Running*_ state

*Symptom*: _/var/log/pSB.log_ may contain: 

{{{2009/07/27 15:11:26 (9029) ERROR> SQL.pm:161 perfSONAR_PS::DB::SQL::openDB - Open error "DBI connect('owamp:localhost','LHCAmi',...) failed: Access denied for user 'XXXXXX'@'localhost' to database 'owamp' at /UNIONFS/usr/local/perfSONAR-PS/perfSONAR_PS-perfSONARBUOY/bin/../lib/perfSONAR_PS/DB/SQL.pm line 158".2009/07/27 15:11:26 (9029) FATAL> perfSONARBUOY.pm:970 perfSONAR_PS::Services::MA::perfSONARBUOY::createStorage - Database error, aborting.2009/07/27 15:11:26 (9029) FATAL> perfSONARBUOY.pm:311 perfSONAR_PS::Services::MA::perfSONARBUOY::init - Couldn't load the store file - service cannot start2009/07/27 15:11:26 (9029) ERROR> daemon.pl:342 main:: - Failed to initialize module perfSONAR_PS::Services::MA::perfSONARBUOY on 8085:/perfSONAR_PS/services/pSB}}}

*Solution*: 

Run the following command (when prompted for password use the MySQL root password, or if none was set hit _enter_):

{{{/usr/local/perfSONAR-PS/perfSONAR_PS-perfSONARBUOY/bin/owdb.pl -i root -c /usr/local/etc}}}
== FAQ ==

TBD

== Last Updated ==

$Id$
